server {
        listen 80;
        listen [::]:80;
        server_name triplefantoche.duckdns.org www.triplefantoche.duckdns.org;
        server_tokens off;

        location ~ /.well-known/acme-challenge/ {
            root /var/www/certbot;
            allow all;
        }

        return 301 https://$host$request_uri;


    }

    server {
        listen 443 default_server ssl http2;
        listen [::]:443 ssl http2;

        server_name triplefantoche.duckdns.org www.triplefantoche.duckdns.org

        ssl_certificate     /etc/letsencrypt/live/triplefantoche.duckdns.org/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/triplefantoche.duckdns.org/privkey.pem;


        root /var/www/html;
        index index.php index.html index.htm;

        location / {
            proxy_pass http://ui-infra:5173;
        }


        location /snippet-service/ {
                proxy_pass http://snippet-service-infra:8081/api/;

                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
                add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization';

                if ($request_method = OPTIONS) {
                    add_header 'Access-Control-Allow-Origin' '*';
                    add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
                    add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization';
                    add_header 'Access-Control-Max-Age' 1728000;
                    add_header 'Content-Length' 0;
                    add_header 'Content-Type' 'text/plain charset=UTF-8';
                    return 204;
                }
            }

        location ~ /.well-known/acme-challenge/ {
            root /var/www/certbot;
            allow all;
        }
    }